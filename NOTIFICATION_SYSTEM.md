# نظام الإشعارات في تطبيق الحجز الطبي

## نظرة عامة

يقدم نظام الإشعارات في تطبيق الحجز الطبي وظائف متقدمة لإعلام المستخدمين بالتغييرات المهمة في مواعيدهم الطبية، بما في ذلك:

1. إشعارات تغيير حالة الموعد (الموافقة، الرفض، التعليق)
2. إشعارات التذكير قبل الموعد بساعتين

## المكونات الرئيسية

### 1. خدمة الإشعارات (Notification Service)
الملف: `lib/notification-service.ts`

يوفر هذا الملف وظائف لإظهار إشعارات المتصفح وإشعارات Toast داخل التطبيق:

- `requestNotificationPermission()`: طلب إذن إشعارات المتصفح
- `showBrowserNotification()`: إظهار إشعارات المتصفح
- `showToastNotification()`: إظهار إشعارات Toast
- `showAppointmentStatusNotification()`: إظهار إشعارات تغيير حالة الموعد
- `showAppointmentReminder()`: إظهار إشعارات تذكير الموعد
- `shouldShowReminder()`: التحقق مما إذا كان الوقت مناسباً لإظهار تذكير

### 2. Hook للاستخدام في المكونات
الملف: `hooks/use-notifications.ts`

يوفر هذا Hook وظائف لإدارة الإشعارات في مكونات React:

- الاشتراك في تغييرات المواعيد باستخدام Supabase Realtime
- التحقق الدوري من مواعيد التذكير
- تسجيل Service Worker

### 3. مكون معالج الإشعارات
الملف: `components/notification-handler.tsx`

مكون React عميل يُستخدم لدمج نظام الإشعارات في الصفحات.

### 4. Service Worker
الملف: `public/sw.js`

يوفر Service Worker إمكانية إظهار الإشعارات في الخلفية حتى عندما لا يكون التطبيق نشطاً.

## كيفية العمل

### إشعارات تغيير الحالة
1. عند تحديث حالة الموعد من قبل المسؤول، يتم إرسال إشعار فوري إلى المستخدم
2. يتم استخدام Supabase Realtime للحصول على التحديثات الفورية
3. يتم عرض الإشعارات كإشعارات متصفح وإشعارات Toast داخل التطبيق

### إشعارات التذكير
1. يتم التحقق من المواعيد كل دقيقة للبحث عن المواعيد القادمة خلال ساعتين
2. عند العثور على موعد، يتم إظهار إشعار تذكير للمستخدم
3. يتم استخدام مؤقت دوري للتحقق من المواعيد

## تكامل النظام

### في صفحة المواعيد
- يتم تضمين `NotificationHandler` في صفحة المواعيد لتفعيل نظام الإشعارات
- يبدأ النظام بمراقبة تغييرات المواعيد وإظهار التذكيرات

### في صفحة إدارة المواعيد (المسؤول)
- عند تغيير حالة الموعد، يتم إظهار إشعار فوري للمستخدم
- يتم دمج نظام الإشعارات مباشرة في أزرار تغيير الحالة

## API للتحقق من التذكيرات

الملف: `app/api/appointment-reminders/route.ts`

يوفر نقطة نهاية API للتحقق من المواعيد القادمة وإرسال التذكيرات. في بيئة الإنتاج، يمكن استدعاء هذا API بشكل دوري باستخدام cron job.

## تخصيص النظام

### تعديل توقيت التذكير
لتعديل توقيت التذكير (الافتراضي: ساعتين قبل الموعد):
1. قم بتعديل الدالة `shouldShowReminder` في `lib/notification-service.ts`
2. قم بتحديث الحساب في API التذكيرات

### تعديل محتوى الإشعارات
لتعديل محتوى الإشعارات:
1. قم بتحديث الدوال `showAppointmentStatusNotification` و `showAppointmentReminder` في `lib/notification-service.ts`
2. قم بتعديل الرسائل والترجمات حسب الحاجة

## متطلبات النظام

1. متصفح يدعم Service Workers (Chrome, Firefox, Edge الحديثة)
2. إذن إشعارات المتصفح من المستخدم
3. اتصال فعال بـ Supabase للحصول على التحديثات الفورية

## التوسع المستقبلي

يمكن توسيع النظام ليدعم:
- إشعارات البريد الإلكتروني
- إشعارات SMS
- إشعارات تطبيقات الهاتف المحمول
- إشعارات أكثر تخصيصاً بناءً على نوع العيادة أو الطبيب